webpackJsonp([24],{536:function(e,t,s){"use strict";function a(e){i||s(644)}Object.defineProperty(t,"__esModule",{value:!0});var r=s(645),n=s(650),i=!1,o=s(6),c=a,l=o(r.a,n.a,!1,c,null,null);l.options.__file="src\\pages\\recommend\\index.vue",l.esModule&&Object.keys(l.esModule).some(function(e){return"default"!==e&&"__"!==e.substr(0,2)}),t.default=l.exports},644:function(e,t){},645:function(e,t,s){"use strict";function a(e){var t=[];return e.permanentPlace&&t.push(e.permanentPlace),e.company&&t.push(e.company),t.join(" · ")}function r(e){return Math.round(e)}var n=s(12),i=s(55),o=s.n(i),c=s(110),l=s(61),d=s(36),h=s(60),u=s(25),g=s(585),m=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])};return function(t,s){function a(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(a.prototype=s.prototype,new a)}}(),f=this&&this.__decorate||function(e,t,s,a){var r,n=arguments.length,i=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,s):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,a);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(i=(n<3?r(i):n>3?r(t,s,i):r(t,s))||i);return n>3&&i&&Object.defineProperty(t,s,i),i},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=this&&this.__awaiter||function(e,t,s,a){return new(s||(s=Promise))(function(r,n){function i(e){try{c(a.next(e))}catch(e){n(e)}}function o(e){try{c(a.throw(e))}catch(e){n(e)}}function c(e){e.done?r(e.value):new s(function(t){t(e.value)}).then(i,o)}c((a=a.apply(e,t||[])).next())})},_=this&&this.__generator||function(e,t){function s(e){return function(t){return a([e,t])}}function a(s){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,n&&(i=n[2&s[0]?"return":s[0]?"throw":"next"])&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[0,i.value]),s[0]){case 0:case 1:i=s;break;case 4:return c.label++,{value:s[1],done:!1};case 5:c.label++,n=s[1],s=[0];continue;case 7:s=c.ops.pop(),c.trys.pop();continue;default:if(i=c.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){c=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){c.label=s[1];break}if(6===s[0]&&c.label<i[1]){c.label=i[1],i=s;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(s);break}i[2]&&c.ops.pop(),c.trys.pop();continue}s=t.call(e,c)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}var r,n,i,o,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pageSize=10,t.loadingText=u.w,t.targetUsers=[],t.recommendedUser=null,t.singleUsers=[],t.singleUserPage={hasMore:!1,curPage:1},t.singleUserListContainer=null,t.loadingSingleUser=!1,t.starGrade=[!1,!1,!1,!1,!1],t.grade=0,t.recommendEnable=!1,t.heart=null,t.showShareImg=!1,t}return m(t,e),t.prototype.mounted=function(){this.singleUserListContainer=this.$refs.singleUserListContainer,this.heart=this.$refs.heart},t.prototype.activated=function(){this.showShareImg=!1,this.recommendedUser=null;var e=this.$route.params;"custom"===e.action?this.initCustomData():"task"===e.action?this.initTaskData():"person"===e.action&&this.initPersonData()},t.prototype.initPersonData=function(){return v(this,void 0,void 0,function(){var e,t,s;return _(this,function(a){switch(a.label){case 0:return e=this.$route.params,[4,l.a.getOtherUserInfo(e.uid)];case 1:return t=a.sent(),s=t.body.obj,this.targetUsers=[s],this.getSingleUsers(e.uid,1),[2]}})})},t.prototype.initCustomData=function(){return v(this,void 0,void 0,function(){var e;return _(this,function(t){switch(t.label){case 0:return[4,l.a.getTaskPublishers(null)];case 1:return e=t.sent(),this.targetUsers=e.body.obj,this.targetUsers.length>0?this.getSingleUsers(this.targetUsers[this.targetUsers.length-1].uid,1):this.getSingleFriends(1),[2]}})})},t.prototype.initTaskData=function(){return v(this,void 0,void 0,function(){var e,t;return _(this,function(s){switch(s.label){case 0:return e=this.$route.params,[4,l.a.getTaskPublishers(e.subId)];case 1:return t=s.sent(),this.targetUsers=t.body.obj,this.getSingleUsers(this.targetUsers[this.targetUsers.length-1].uid,1),[2]}})})},t.prototype.getSingleFriends=function(e){var t=d.a.getFriendsByPage(e,this.pageSize,!0);1===e&&(this.singleUsers=[]),this.singleUsers=this.singleUsers.concat(t.rows),d.a.checkPage(this.singleUserPage,t.page)},t.prototype.getSingleUsers=function(e,t){return v(this,void 0,void 0,function(){var s,a;return _(this,function(r){switch(r.label){case 0:return[4,l.a.getRecommendedUsersByUid(e,t,this.pageSize)];case 1:return s=r.sent(),1===t&&(this.singleUsers=[]),this.singleUsers=this.singleUsers.concat(s.body.obj.rows),a=s.body.obj.page,d.a.checkPage(this.singleUserPage,a),[2]}})})},t.prototype.loadMoreSingleUser=function(){this.loadingSingleUser=!0;try{if(0===this.targetUsers.length)this.getSingleFriends(this.singleUserPage.curPage+1);else{var e=this.targetUsers[this.targetUsers.length-1],t=e.fid||e.uid;this.getSingleUsers(t,this.singleUserPage.curPage+1)}}catch(e){this.showToast(new h.a(e.message)),this.singleUserPage.hasMore=!1}finally{this.loadingSingleUser=!1}},t.prototype.setStarGrade=function(e){var t=e.target,s=t.getAttribute("data-star");if(s){var a=parseInt(s,10);this.setStars(a)}},t.prototype.recommend=function(){return v(this,void 0,void 0,function(){var e,t,s,a,r,n,i=this;return _(this,function(o){switch(o.label){case 0:e=this.targetUsers[this.targetUsers.length-1],t=e.fid||e.uid,s=this.recommendedUser.uid,a=this.grade,r=e.subId||null,this.heart.classList.add("scale"),setTimeout(function(){i.heart.classList.remove("scale")},1050),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,l.a.recommend(t,s,r,a)];case 2:return o.sent(),this.recommendedUser.recommended=1,this.changeRecommendedUser(null),[3,4];case 3:return n=o.sent(),this.showToast(new h.a(n.message)),[3,4];case 4:return[2]}})})},t.prototype.dragHandler=function(e,t){var s=e.currentTarget,a=e.gesture;a.speed>.4||Math.abs(a.deltaX)>300?(a.deltaX>0?s.setAttribute("direction","right"):s.setAttribute("direction","left"),s.setAttribute("deltaY",""+a.deltaY),"targetUser"===t.type?(this.changeRecommendedUser(null),this.targetUsers.splice(this.targetUsers.length-1,1),0===this.targetUsers.length?this.getSingleFriends(1):this.getSingleUsers(this.targetUsers[this.targetUsers.length-1].uid,1)):this.changeRecommendedUser(null)):s.style.cssText="transform: translate3d(0px, 0px, 0); transition: transform 0.5s;-webkit-transform: translate3d(0px, 0px, 0); -webkit-transition: transform 0.5s;z-index:3"},t.prototype.animateBeforeLeave=function(e){var t=e.getAttribute("deltaY")||0,s=e.getAttribute("direction")||"right";e.style.cssText="right"===s?"transform: translate3d(1000px,"+t+"px, 0); transition: transform 1s;-webkit-transform: translate3d(1000px,"+t+"px, 0); -webkit-transition: transform 1s;z-index:3":"transform: translate3d(-1000px,"+t+"px, 0); transition: transform 1s;-webkit-transform: translate3d(-1000px,"+t+"px, 0); -webkit-transition: transform 1s;z-index:3"},t.prototype.setTargetUser=function(e){this.targetUsers.push(e),this.getSingleUsers(e.fid,1)},t.prototype.setRecommendedUser=function(e){if(1===e.recommended)return void this.showToast(new h.a("已推荐过此用户"));this.changeRecommendedUser(e)},t.prototype.changeRecommendedUser=function(e){this.recommendedUser&&(this.recommendedUser.selected=!1),e?(this.setStars(Math.round(e.matchingScore)),e.selected=!0,this.recommendEnable=!0):(this.setStars(0),this.recommendEnable=!1),this.recommendedUser=e},t.prototype.setStars=function(e){switch(this.grade=e,e){case 0:this.starGrade=[!1,!1,!1,!1,!1];break;case 1:this.starGrade=[!0,!1,!1,!1,!1];break;case 2:this.starGrade=[!0,!0,!1,!1,!1];break;case 3:this.starGrade=[!0,!0,!0,!1,!1];break;case 4:this.starGrade=[!0,!0,!0,!0,!1];break;case 5:this.starGrade=[!0,!0,!0,!0,!0]}},f([Object(c.a)("showToast"),p("design:type",Object)],t.prototype,"showToast",void 0),t=f([o()({filters:{permanentPlaceAndCompany:a,MathRound:r},components:{"share-image":g.a}})],t)}(n.default);t.a=U},650:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"singleUserListContainer",staticClass:"content",attrs:{id:"recommend"}},[s("transition-group",{staticClass:"select-content",attrs:{tag:"div"},on:{"before-leave":e.animateBeforeLeave}},[s("div",{key:0,staticClass:"target-box"},[s("div",{staticClass:"select-wrapper"},[s("div",{staticClass:"select-box",staticStyle:{width:"100%"}},[s("div",{staticClass:"avatar unselect"}),e._v(" "),s("div",{staticClass:"unselected-hint"},[e._v("虚位以待")])])])]),e._v(" "),e._l(e.targetUsers,function(t,a){return s("div",{directives:[{name:"drag",rawName:"v-drag",value:{params:{type:"targetUser"},handler:e.dragHandler},expression:"{ params: { type: 'targetUser' }, handler: dragHandler }"}],key:t.subId?t.subId:t.fid?t.fid:t.uid,staticClass:"target-box"},[s("div",{staticClass:"select-wrapper"},[s("div",{staticClass:"select-box recommend-box"},[s("load-img",{staticClass:"avatar",attrs:{type:"img",url:t.headPortrait}}),e._v(" "),s("div",{staticClass:"realname",attrs:{draggable:"true"},on:{drag:function(t){e.dragtargetUser(t,a)}}},[e._v(e._s(t.realname))])],1)])])}),e._v(" "),s("div",{key:1,staticClass:"recommend-box"},[s("div",{staticClass:"select-wrapper"},[s("div",{staticClass:"select-box",staticStyle:{width:"100%"}},[s("div",{staticClass:"avatar unselect"}),e._v(" "),s("div",{staticClass:"unselected-hint"},[e._v("虚位以待")])])])]),e._v(" "),e.recommendedUser?s("div",{directives:[{name:"drag",rawName:"v-drag",value:{params:{type:"recommendedUser"},handler:e.dragHandler},expression:"{ params: { type: 'recommendedUser' }, handler: dragHandler }"}],key:2,staticClass:"recommend-box"},[s("div",{staticClass:"select-wrapper"},[s("div",{staticClass:"select-box recommend-box"},[s("load-img",{staticClass:"avatar",attrs:{type:"div",url:e.recommendedUser.headPortrait}}),e._v(" "),s("div",{staticClass:"realname"},[e._v(e._s(e.recommendedUser.realname))])],1)])]):e._e(),e._v(" "),s("i",{key:3,ref:"heart",staticClass:"iconfont icon-like_fill ion-heart",attrs:{id:"heart"}})],2),e._v(" "),s("div",{staticClass:"recommend-score-content",on:{click:function(t){e.recommendEnable&&e.setStarGrade(t)}}},[s("span",[e._v("推荐指数：")]),e._v(" "),s("i",{staticClass:"iconfont",class:e.starGrade[0]?"icon-like_fill":"icon-like",attrs:{"data-action":"star","data-star":"1"}}),e._v(" "),s("i",{staticClass:"iconfont",class:e.starGrade[1]?"icon-like_fill":"icon-like",attrs:{"data-action":"star","data-star":"2"}}),e._v(" "),s("i",{staticClass:"iconfont",class:e.starGrade[2]?"icon-like_fill":"icon-like",attrs:{"data-action":"star","data-star":"3"}}),e._v(" "),s("i",{staticClass:"iconfont",class:e.starGrade[3]?"icon-like_fill":"icon-like",attrs:{"data-action":"star","data-star":"4"}}),e._v(" "),s("i",{staticClass:"iconfont",class:e.starGrade[4]?"icon-like_fill":"icon-like",attrs:{"data-action":"star","data-star":"5"}})]),e._v(" "),s("mu-raised-button",{staticClass:"recommend-button",class:e.recommendEnable?"active":"unactive",attrs:{label:"推荐",fullWidth:""},on:{click:function(t){e.recommendEnable&&e.recommend()}}}),e._v(" "),s("div",{staticClass:"friend-title"},[e._v("推荐列表"),s("i",{staticClass:"iconfont icon-yaoqinghaoyou",on:{click:function(t){e.showShareImg=!0}}})]),e._v(" "),0===e.targetUsers.length&&0===e.singleUsers.length?s("div",{staticClass:"recommend-friend hint"},[e._v("\n        暂时没有好友列表！\n    ")]):0===e.targetUsers.length&&e.singleUsers.length>0?e._l(e.singleUsers,function(t){return s("div",{key:t.fid,staticClass:"recommend-friend",on:{click:function(s){e.setTargetUser(t)}}},[s("load-img",{staticClass:"avatar",attrs:{type:"div",url:t.headPortrait}}),e._v(" "),s("div",{staticClass:"info"},[s("div",{staticClass:"realname"},[e._v(e._s(t.realname))]),e._v(" "),s("div",[e._v(e._s(t.age)+"岁 "+e._s(t.constellation)+" "+e._s(t.height?t.height+"cm":""))]),e._v(" "),s("div",[e._v(e._s(e._f("permanentPlaceAndCompany")(t)))])])],1)}):e.targetUsers.length>0&&0===e.singleUsers.length?s("div",{staticClass:"recommend-friend hint"},[e._v("\n        暂时没有合适的推荐列表！\n    ")]):e._l(e.singleUsers,function(t){return s("div",{key:t.uid,staticClass:"recommend-friend",class:t.selected?"selected":1===t.recommended?"recommended":"",on:{click:function(s){e.setRecommendedUser(t)}}},[s("load-img",{staticClass:"avatar",attrs:{type:"div",url:t.headPortrait}}),e._v(" "),s("div",{staticClass:"info"},[s("div",{staticClass:"realname"},[e._v(e._s(t.realname))]),e._v(" "),s("div",[e._v(e._s(t.age)+"岁 "+e._s(t.constellation)+" "+e._s(t.height?t.height+"cm":""))]),e._v(" "),s("div",[e._v(e._s(e._f("permanentPlaceAndCompany")(t)))])]),e._v(" "),s("div",{staticClass:"score"},[e._v("推荐指数："+e._s(e._f("MathRound")(t.matchingScore)))]),e._v(" "),1===t.recommended?s("i",{staticClass:"iconfont icon-yituijian"}):e._e()],1)}),e._v(" "),e.singleUserPage.hasMore?s("mu-infinite-scroll",{attrs:{scroller:e.singleUserListContainer,loading:e.loadingSingleUser,loadingText:e.loadingText},on:{load:e.loadMoreSingleUser}}):e._e(),e._v(" "),e.showShareImg?s("share-image",{on:{hide:function(t){e.showShareImg=!1}}}):e._e()],2)},r=[];a._withStripped=!0;var n={render:a,staticRenderFns:r};t.a=n}});
//# sourceMappingURL=24.7d057a01edd6218027eb.js.map