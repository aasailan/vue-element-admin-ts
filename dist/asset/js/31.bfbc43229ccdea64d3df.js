webpackJsonp([31],{567:function(t,e,a){"use strict";function n(t){o||a(785)}Object.defineProperty(e,"__esModule",{value:!0});var s=a(786),i=a(787),o=!1,r=a(6),p=n,c=r(s.a,i.a,!1,p,null,null);c.options.__file="src\\pages\\openTask\\index.vue",c.esModule&&Object.keys(c.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)}),e.default=c.exports},785:function(t,e){},786:function(t,e,a){"use strict";var n=a(12),s=a(55),i=a.n(s),o=a(77),r=(a.n(o),a(110)),p=a(575),c=a(577),u=a(25),l=a(78),h=a(61),m=a(111),k=a(60),d=a(580),T=a(579),f=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function n(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}(),b=this&&this.__decorate||function(t,e,a,n){var s,i=arguments.length,o=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,a,n);else for(var r=t.length-1;r>=0;r--)(s=t[r])&&(o=(i<3?s(o):i>3?s(e,a,o):s(e,a))||o);return i>3&&o&&Object.defineProperty(e,a,o),o},y=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},v=this&&this.__awaiter||function(t,e,a,n){return new(a||(a=Promise))(function(s,i){function o(t){try{p(n.next(t))}catch(t){i(t)}}function r(t){try{p(n.throw(t))}catch(t){i(t)}}function p(t){t.done?s(t.value):new a(function(e){e(t.value)}).then(o,r)}p((n=n.apply(t,e||[])).next())})},g=this&&this.__generator||function(t,e){function a(t){return function(e){return n([t,e])}}function n(a){if(s)throw new TypeError("Generator is already executing.");for(;p;)try{if(s=1,i&&(o=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return p.label++,{value:a[1],done:!1};case 5:p.label++,i=a[1],a=[0];continue;case 7:a=p.ops.pop(),p.trys.pop();continue;default:if(o=p.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){p=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){p.label=a[1];break}if(6===a[0]&&p.label<o[1]){p.label=o[1],o=a;break}if(o&&p.label<o[2]){p.label=o[2],p.ops.push(a);break}o[2]&&p.ops.pop(),p.trys.pop();continue}a=e.call(t,p)}catch(t){a=[6,t],i=0}finally{s=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var s,i,o,r,p={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},P=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.submitData={taskType:2,subject:"公开任务",duration:30,leaveMsg:"",subType:2,totalAmount:0,totalCount:null,redPacketType:1,range:{rangeType:1,permanentPlace:null,companys:[]}},e.openTask={submitData:e.submitData,redPacketPrice:"",totalCount:"",isableSubmit:!1,tipInfo:"",multiLineInputErrorText:"",dateOptions:[]},e.pickerTheme=null,e.pickerType=null,e.pickerData=null,e.showOpenTaskModal=!1,e}return f(e,t),Object.defineProperty(e.prototype,"companyCache",{get:function(){return T.a.companyCache},enumerable:!0,configurable:!0}),e.prototype.mounted=function(){var t=this;l.a.beforeEach(function(e,a,n){"taskSelect"===e.name&&"openTask"===a.name?(t.initData(),n()):n()}),this.calculateTotalAmount()},e.prototype.activated=function(){this.showOpenTaskModal=!0;for(var t=1;t<25;t++)this.openTask.dateOptions.push(5*t);this.openTask.submitData.range.companys=this.companyCache,this.errorHint()},e.prototype.deactivated=function(){this.showOpenTaskModal=!1,this.isShowModal&&this.cancel()},e.prototype.initData=function(){this.submitData={taskType:2,subject:"公开任务",duration:30,leaveMsg:"",subType:2,totalAmount:0,totalCount:null,redPacketType:1,range:{rangeType:1,permanentPlace:null,companys:[]}},this.openTask={submitData:this.submitData,redPacketPrice:"",totalCount:"",isableSubmit:!1,tipInfo:"",multiLineInputErrorText:"",dateOptions:[]},T.a.$emit(m.a.addCompanyInOpenTask,[])},e.prototype.watchAmout=function(t,e){this.checkAmout()},e.prototype.watchCount=function(t,e){this.checkCount()},Object.defineProperty(e.prototype,"RangeText",{get:function(){return u.O[this.openTask.submitData.range.rangeType-1]},enumerable:!0,configurable:!0}),e.prototype.handleMultiLineOverflow=function(t){this.openTask.multiLineInputErrorText=t?"超过字数限制啦！":"",this.errorHint()},e.prototype.calculateTotalAmount=function(){""===this.openTask.totalCount||""===this.openTask.redPacketPrice?this.openTask.submitData.totalAmount=0:1===this.openTask.submitData.redPacketType?this.openTask.submitData.totalAmount=parseInt(this.openTask.totalCount,10)*parseFloat(this.openTask.redPacketPrice):this.openTask.submitData.totalAmount=parseFloat(this.openTask.redPacketPrice)},e.prototype.changeRedBagType=function(){if(1===this.openTask.submitData.redPacketType)0===this.openTask.submitData.totalAmount?(this.openTask.submitData.redPacketType=2,this.openTask.redPacketPrice=""):(this.openTask.redPacketPrice=this.openTask.submitData.totalAmount.toFixed(2),this.openTask.submitData.redPacketType=2);else if(0===this.openTask.submitData.totalAmount)this.openTask.submitData.redPacketType=1,this.openTask.redPacketPrice="";else{var t=this.openTask.submitData.totalAmount/parseInt(this.openTask.totalCount,10);this.openTask.redPacketPrice=t.toFixed(2),this.openTask.submitData.totalAmount=t*parseInt(this.openTask.totalCount,10),this.openTask.submitData.redPacketType=1}},e.prototype.checkAmout=function(){this.openTask.redPacketPrice=this.openTask.redPacketPrice.replace(/[^\d.]/g,""),this.openTask.redPacketPrice=this.openTask.redPacketPrice.replace(/\.{2,}/g,"."),this.openTask.redPacketPrice=this.openTask.redPacketPrice.replace(".","$#$").replace(/\./g,"").replace("$#$","."),this.openTask.redPacketPrice=this.openTask.redPacketPrice.replace(/^(0+)(\d+)\.(\d*).*$/,"$2.$3"),this.openTask.redPacketPrice=this.openTask.redPacketPrice.replace(/^\.(\d+).*$/,"0.$1"),this.openTask.redPacketPrice=this.openTask.redPacketPrice.replace(/^(\d+)\.(\d\d).*$/,"$1.$2"),this.openTask.redPacketPrice.indexOf(".")<0&&""!==this.openTask.redPacketPrice&&(this.openTask.redPacketPrice=String(parseFloat(this.openTask.redPacketPrice))),this.errorHint(),this.calculateTotalAmount()},e.prototype.checkCount=function(){1===this.openTask.totalCount.length?this.openTask.totalCount=this.openTask.totalCount.replace(/[^1-9]/g,"1"):(this.openTask.totalCount=this.openTask.totalCount.replace(/\D/g,""),this.openTask.totalCount=""===this.openTask.totalCount?"":this.openTask.totalCount,this.openTask.totalCount.indexOf(".")<0&&""!==this.openTask.totalCount&&(this.openTask.totalCount=String(parseInt(this.openTask.totalCount,10)))),this.errorHint(),this.calculateTotalAmount()},e.prototype.errorHint=function(){var t=parseInt(this.openTask.totalCount,10),e=!0,a=!0;return parseFloat(this.openTask.redPacketPrice)>0?1===this.openTask.submitData.redPacketType&&parseFloat(this.openTask.redPacketPrice)>u.A?(this.openTask.isableSubmit=!1,void(this.openTask.tipInfo="单个红包金额不能超过"+u.A+"元")):2===this.openTask.submitData.redPacketType&&this.openTask.submitData.totalAmount/t>u.A?(this.openTask.isableSubmit=!1,void(this.openTask.tipInfo="单个红包金额不能超过"+u.A+"元")):(this.openTask.isableSubmit=!0,this.openTask.tipInfo="",t<=u.B&&t>0?(this.openTask.isableSubmit=!0,this.openTask.tipInfo=""):t>u.B?(this.openTask.tipInfo="最多只能发"+u.B+"个红包，请修改红包个数",this.openTask.isableSubmit=!1):(this.openTask.tipInfo="请输入大于0的红包个数",this.openTask.isableSubmit=!1),this.openTask.submitData.leaveMsg.length>150&&(e=!1),3!==this.openTask.submitData.range.rangeType&&4!==this.openTask.submitData.range.rangeType||(a=this.openTask.submitData.range.companys.length>0),void(e&&a||(this.openTask.isableSubmit=!1))):(this.openTask.isableSubmit=!1,void(this.openTask.tipInfo="请输入大于0的红包金额"))},e.prototype.showDuetimeSet=function(){var t=this.openTask.submitData.duration||30;this.pickerData=[{list:this.openTask.dateOptions,currentIndex:this.openTask.dateOptions.indexOf(t)}],this.pickerTheme="dueTimeSet",this.pickerType="",this.addModal(u.D)},e.prototype.confirmDuetime=function(t){this.openTask.submitData.duration=t.values[0]},e.prototype.showRegionSet=function(){var t=this.openTask.submitData.range.rangeType||1;this.pickerData=[{list:u.O,currentIndex:t-1}],this.pickerTheme="regionSet",this.pickerType="",this.addModal(u.D)},e.prototype.confirmRegion=function(t){var e=t.indexvalues[0]+1;this.openTask.submitData.range.rangeType=e,3!==e&&4!==e&&(this.openTask.submitData.range.companys=[]),3===e||5===e?null===this.openTask.submitData.range.permanentPlace&&(this.openTask.submitData.range.permanentPlace=this.userInfo.permanentPlace||"深圳市"):this.openTask.submitData.range.permanentPlace=null,this.errorHint()},e.prototype.showCitySelect=function(){this.pickerTheme="permanentPlace",this.pickerType="city";var t=this.openTask.submitData.range.permanentPlace?this.openTask.submitData.range.permanentPlace:"深圳市",e=Object(d.b)(t);this.pickerData=[{list:d.c,currentIndex:d.c.indexOf(e)},{list:d.a[e],currentIndex:d.a[e].indexOf(t)}],this.addModal(u.D)},e.prototype.toAddCompanysPage=function(){this.$router.push({name:"addCompanys"})},e.prototype.deleteCompany=function(t){var e=this.openTask.submitData.range.companys.indexOf(t);this.openTask.submitData.range.companys.splice(e,1),this.errorHint()},e.prototype.confirmPermanentPlace=function(t){this.openTask.submitData.range.permanentPlace=t.values[1]},e.prototype.cancel=function(){this.isShowModal&&this.hideModal()},e.prototype.confirm=function(t){switch(t.theme){case"dueTimeSet":this.confirmDuetime(t);break;case"regionSet":this.confirmRegion(t);break;case"permanentPlace":this.confirmPermanentPlace(t)}this.cancel()},e.prototype.submitOrder=function(){return v(this,void 0,void 0,function(){var t,e,a,n,s;return g(this,function(i){switch(i.label){case 0:this.showLoading(),i.label=1;case 1:return i.trys.push([1,3,,4]),t=100*this.openTask.submitData.totalAmount,this.openTask.submitData.totalAmount=parseInt(t.toFixed(0),10),this.openTask.submitData.totalCount=parseInt(this.openTask.totalCount,10),[4,h.a.submitTaskOrder(this.openTask.submitData)];case 2:return e=i.sent(),this.hideLoading(),a=e.body.obj,this.initData(),n={taskId:a.taskId,action:"fromTask"},T.a.$emit(m.a.payParams,n),this.$router.replace({name:"pay",params:n}),[3,4];case 3:return s=i.sent(),this.hideLoading(),this.calculateTotalAmount(),this.showToast(new k.a(s.message)),[3,4];case 4:return[2]}})})},b([Object(r.c)(function(t){return t.user.user}),y("design:type",Object)],e.prototype,"userInfo",void 0),b([Object(r.c)(function(t){return t.modal.MODAL_0}),y("design:type",Object)],e.prototype,"isShowModal",void 0),b([Object(r.a)("addModal"),y("design:type",Object)],e.prototype,"addModal",void 0),b([Object(r.a)("hideModal"),y("design:type",Object)],e.prototype,"hideModal",void 0),b([Object(r.a)("showToast"),y("design:type",Object)],e.prototype,"showToast",void 0),b([Object(r.a)("showLoading"),y("design:type",Object)],e.prototype,"showLoading",void 0),b([Object(r.a)("hideLoading"),y("design:type",Object)],e.prototype,"hideLoading",void 0),b([Object(o.Watch)("openTask.redPacketPrice"),y("design:type",Function),y("design:paramtypes",[Object,Object]),y("design:returntype",void 0)],e.prototype,"watchAmout",null),b([Object(o.Watch)("openTask.totalCount"),y("design:type",Function),y("design:paramtypes",[Object,Object]),y("design:returntype",void 0)],e.prototype,"watchCount",null),e=b([i()({components:{"mu-text-field":p.a,picker:c.a}})],e)}(n.default);e.a=P},787:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content",attrs:{id:"open-task-view"}},[a("div",{staticClass:"task-issue-content"},[""!==t.openTask.tipInfo?a("div",{staticClass:"hint-tips"},[t._v(t._s(t.openTask.tipInfo))]):t._e(),t._v(" "),a("div",{staticClass:"top-title-task"},[t._v("设置红包")]),t._v(" "),a("div",{staticClass:"item-input"},[a("span",{staticClass:"item-left"},[t._v(t._s(1===t.openTask.submitData.redPacketType?"单个金额":"总金额"))]),t._v(" "),a("span",{staticClass:"item-note"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.openTask.redPacketPrice,expression:"openTask.redPacketPrice"}],ref:"inputOpenTaskAmout",staticClass:"price-input",attrs:{placeholder:"0.00",onkeyup:"if(event.keyCode === 32){this.value=this.value.replace(/\\s*$/g, '');this.value=this.value.replace(/^\\s+/, '')}"},domProps:{value:t.openTask.redPacketPrice},on:{input:function(e){e.target.composing||t.$set(t.openTask,"redPacketPrice",e.target.value)}}}),t._v("元")])]),t._v(" "),a("div",{staticClass:"info-note-task"},[a("span",[t._v(t._s(1===t.openTask.submitData.redPacketType?"当前为普通红包":"当前为随机红包")+"， ")]),a("span",{staticStyle:{color:"#fe7777"},on:{click:t.changeRedBagType}},[t._v(t._s(1===t.openTask.submitData.redPacketType?"改为随机红包":"改为普通红包"))])]),t._v(" "),a("div",{staticClass:"item-input"},[a("span",{staticClass:"item-left"},[t._v("红包数目")]),t._v(" "),a("span",{staticClass:"item-note"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.openTask.totalCount,expression:"openTask.totalCount"}],staticClass:"price-input",attrs:{name:"totalAmout",placeholder:"请输入红包个数",onkeyup:"if(event.keyCode === 32){this.value=this.value.replace(/\\s*$/g, '');this.value=this.value.replace(/^\\s+/, '')}"},domProps:{value:t.openTask.totalCount},on:{oninput:function(e){t.checkCount()},input:function(e){e.target.composing||t.$set(t.openTask,"totalCount",e.target.value)}}}),t._v("个")])]),t._v(" "),a("mu-text-field",{attrs:{label:"留言",labelClass:"text-field-title",hintTextClass:"text-field-title",hintText:"最多输入150个字",errorText:t.openTask.multiLineInputErrorText,maxLength:150,multiLine:"",underlineShow:!1},on:{textOverflow:t.handleMultiLineOverflow},model:{value:t.openTask.submitData.leaveMsg,callback:function(e){t.$set(t.openTask.submitData,"leaveMsg",e)},expression:"openTask.submitData.leaveMsg"}}),t._v(" "),a("mu-list-item",{staticClass:"normal-list-item",attrs:{title:"设置任务期限",afterText:t.openTask.submitData.duration+"天"},on:{click:t.showDuetimeSet}},[a("i",{staticClass:"iconfont icon-list-more",attrs:{slot:"right"},slot:"right"})]),t._v(" "),a("mu-list-item",{staticClass:"normal-list-item",attrs:{title:"设置公开范围",afterText:t.RangeText},on:{click:function(e){t.showRegionSet()}}},[a("i",{staticClass:"iconfont icon-list-more",attrs:{slot:"right"},slot:"right"})]),t._v(" "),a("div",{staticClass:"info-note-task"},[t._v("提示：仅该范围内的用户能看到您的悬赏信息，其中单位和地区指用户填写的工作单位和常住地。\n            "),a("router-link",{attrs:{to:{name:"userProtocol"}}},[t._v("详细规则")])],1),t._v(" "),3===t.openTask.submitData.range.rangeType||5===t.openTask.submitData.range.rangeType?a("mu-list-item",{staticClass:"normal-list-item",attrs:{title:"限定常住地",afterText:null===t.openTask.submitData.range.permanentPlace?"请选择匹配城市":t.openTask.submitData.range.permanentPlace},on:{click:function(e){t.showCitySelect()}}},[a("i",{staticClass:"iconfont icon-list-more",attrs:{slot:"right"},slot:"right"})]):t._e(),t._v(" "),3===t.openTask.submitData.range.rangeType||4===t.openTask.submitData.range.rangeType?a("mu-list-item",{staticClass:"normal-list-item",attrs:{title:"限定单位"},on:{click:function(e){t.toAddCompanysPage()}}},[a("i",{staticClass:"iconfont icon-list-more",attrs:{slot:"right"},slot:"right"})]):t._e(),t._v(" "),t.openTask.submitData.range.companys.length>0?a("mu-list",t._l(t.openTask.submitData.range.companys,function(e,n){return a("mu-list-item",{key:n,staticClass:"normal-list-item company-item"},[a("span",{staticClass:"item-name"},[t._v(t._s(e))]),t._v(" "),a("span",{staticClass:"item-icon"},[a("i",{staticClass:"iconfont icon-jianhao-big",on:{click:function(a){t.deleteCompany(e)}}})])])})):t._e()],1),t._v(" "),a("div",{staticClass:"bottom-submit-button"},[a("mu-raised-button",{staticClass:"submit-button",attrs:{disabled:!t.openTask.isableSubmit,primary:""},on:{click:function(e){t.submitOrder()}}},[t._v("提交订单")]),t._v(" "),a("span",{staticClass:"total-price"},[t._v("合计："),a("i",{staticClass:"iconfont icon-match-maker-price"},[t._v(t._s(t.openTask.submitData.totalAmount.toFixed(2)))])])],1),t._v(" "),t.showOpenTaskModal?a("picker",{attrs:{isShowPicker:t.isShowModal,theme:t.pickerTheme,type:t.pickerType,pickerData:t.pickerData},on:{cancel:t.cancel,confirm:t.confirm}}):t._e()],1)},s=[];n._withStripped=!0;var i={render:n,staticRenderFns:s};e.a=i}});
//# sourceMappingURL=31.bfbc43229ccdea64d3df.js.map