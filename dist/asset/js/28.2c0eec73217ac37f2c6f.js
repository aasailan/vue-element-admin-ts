webpackJsonp([28],{550:function(t,e,o){"use strict";function n(t){s||o(716)}Object.defineProperty(e,"__esModule",{value:!0});var i=o(717),a=o(718),s=!1,r=o(6),c=n,l=r(i.a,a.a,!1,c,null,null);l.options.__file="src\\pages\\photos\\index.vue",l.esModule&&Object.keys(l.esModule).some(function(t){return"default"!==t&&"__"!==t.substr(0,2)}),e.default=l.exports},716:function(t,e){},717:function(t,e,o){"use strict";var n=o(12),i=o(55),a=o.n(i),s=o(110),r=o(163),c=o(159),l=o(61),u=o(60),p=o(25),d=o(578),h=o(576),f=o.n(h),y=o(77),b=(o.n(y),this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}()),g=this&&this.__decorate||function(t,e,o,n){var i,a=arguments.length,s=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,n);else for(var r=t.length-1;r>=0;r--)(i=t[r])&&(s=(a<3?i(s):a>3?i(e,o,s):i(e,o))||s);return a>3&&s&&Object.defineProperty(e,o,s),s},m=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},w=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))(function(i,a){function s(t){try{c(n.next(t))}catch(t){a(t)}}function r(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){t.done?i(t.value):new o(function(e){e(t.value)}).then(s,r)}c((n=n.apply(t,e||[])).next())})},v=this&&this.__generator||function(t,e){function o(t){return function(e){return n([t,e])}}function n(o){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,a&&(s=a[2&o[0]?"return":o[0]?"throw":"next"])&&!(s=s.call(a,o[1])).done)return s;switch(a=0,s&&(o=[0,s.value]),o[0]){case 0:case 1:s=o;break;case 4:return c.label++,{value:o[1],done:!1};case 5:c.label++,a=o[1],o=[0];continue;case 7:o=c.ops.pop(),c.trys.pop();continue;default:if(s=c.trys,!(s=s.length>0&&s[s.length-1])&&(6===o[0]||2===o[0])){c=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){c.label=o[1];break}if(6===o[0]&&c.label<s[1]){c.label=s[1],s=o;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(o);break}s[2]&&c.ops.pop(),c.trys.pop();continue}o=e.call(t,c)}catch(t){o=[6,t],a=0}finally{i=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var i,a,s,r,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isUploading=!1,e.params={action:null,id:null},e.imgHost=p.q,e.album=[],e.maxCount=8,e.showIndex=null,e.deleteIndex=null,e.dialog=!1,e.isCroping=!1,e.myCroppaOption={fullScreen:!0,fromCamera:!1,compressionRate:.8,quality:6},e}return b(e,t),Object.defineProperty(e.prototype,"isMySelf",{get:function(){return!(!this.myInfo||this.params.id!==this.myInfo.uid)},enumerable:!0,configurable:!0}),e.prototype.updateView=function(){for(var t=[],e=0,o=this.album;e<o.length;e++){var n=o[e];t.push(n.url)}this.updateViewImgs(t)},e.prototype.activated=function(){var t=this.$route.params;this.params=t,this.isUploading=!1,this.isCroping=!1,this.getAlbum()},e.prototype.getAlbum=function(){return w(this,void 0,void 0,function(){var t,t,e;return v(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),"recommendation"!==this.params.action?[3,2]:[4,l.a.getAlbumByLetterId(this.params.id)];case 1:return t=o.sent(),this.album=t.body.obj,[3,4];case 2:return[4,l.a.getAlbum(this.params.id)];case 3:t=o.sent(),this.album=t.body.obj,o.label=4;case 4:return[3,6];case 5:return e=o.sent(),this.showToast(new u.a(e.message)),[3,6];case 6:return[2]}})})},e.prototype.deactivated=function(){this.close(),this.isUploading&&this.destoried(),this.isCroping&&this.hideCroppa();var t={isShow:!1,showIndex:1};this.toggleView(t)},e.prototype.clickPhoto=function(t){var e=t.target,o=e.getAttribute("data-action");if("show"===o){this.showIndex=parseInt(e.getAttribute("data-index"),10);var n={isShow:!0,showIndex:this.showIndex};this.toggleView(n)}else"delete"===o&&(this.deleteIndex=parseInt(e.getAttribute("data-index"),10),this.dialog=!0)},e.prototype.close=function(){this.dialog=!1},e.prototype.cancel=function(){this.close()},e.prototype.confirm=function(){return w(this,void 0,void 0,function(){var t,e;return v(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,l.a.deletePhoto(this.album[this.deleteIndex].id)];case 1:return t=o.sent(),this.album.splice(this.deleteIndex,1),[3,3];case 2:return e=o.sent(),this.showToast(new u.a(e.message)),[3,3];case 3:return this.close(),[2]}})})},e.prototype.selectPhoto=function(){this.isCroping=!0,this.$refs.croppa.chooseFile()},e.prototype.confirmCroppa=function(t){var e=this;this.showLoading();var o=p.U,n={"access-token":this.$store.state.token},i={base64Code:t.base64Code,type:t.type,filename:t.filename,filed:"file"};f()("POST",o,n,i,function(t){return w(e,void 0,void 0,function(){var e,o;return v(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,5,6]),e=t.msgStatus,0!==e?[3,2]:[4,this.getAlbum()];case 1:return n.sent(),this.showToast(new u.a("上传相册成功")),[3,3];case 2:throw new Error(t.msgText);case 3:return[3,6];case 4:return o=n.sent(),this.showToast(new u.a(o.message)),[3,6];case 5:return this.hideLoading(),this.hideCroppa(),[7];case 6:return[2]}})})},function(){e.showToast(new u.a("上传失败")),e.hideLoading(),e.hideCroppa()},!0,!0)},e.prototype.cancelCroppa=function(){this.hideCroppa()},e.prototype.hideCroppa=function(){this.$refs.croppa.hide(),this.isCroping=!1},g([Object(s.a)("showToast"),m("design:type",Object)],e.prototype,"showToast",void 0),g([Object(s.a)("showLoading"),m("design:type",Object)],e.prototype,"showLoading",void 0),g([Object(s.a)("hideLoading"),m("design:type",Object)],e.prototype,"hideLoading",void 0),g([Object(s.a)("updateViewImgs"),m("design:type",Object)],e.prototype,"updateViewImgs",void 0),g([Object(s.a)("toggleView"),m("design:type",Object)],e.prototype,"toggleView",void 0),g([Object(s.c)(function(t){return t.user.user}),m("design:type",Object)],e.prototype,"myInfo",void 0),g([Object(y.Watch)("album"),m("design:type",Function),m("design:paramtypes",[]),m("design:returntype",void 0)],e.prototype,"updateView",null),e=g([a()({components:{"mu-dialog":r.a,"mu-flat-button":c.a,"my-croppa":d.a}})],e)}(n.default);e.a=_},718:function(t,e,o){"use strict";var n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"content",attrs:{id:"photo"}},[o("div",{staticClass:"photo-content",on:{click:function(e){t.clickPhoto(e)}}},[t._l(t.album,function(e,n){return o("load-img",{key:e.id,staticClass:"photo-wrap center-bg",attrs:{type:"div",url:e.url,"data-action":"show","data-index":n}},[t.isMySelf?o("i",{staticClass:"iconfont icon-clear",attrs:{"data-action":"delete","data-index":n}}):t._e()])}),t._v(" "),t.isMySelf&&t.album.length<t.maxCount?o("div",{staticClass:"photo-wrap add-photo",staticStyle:{width:"31%"},attrs:{"data-action":"add"},on:{click:function(e){e.stopPropagation(),t.selectPhoto(e)}}},[o("span",{attrs:{"data-action":"add"}},[t._v("添加照片")])]):t._e(),t._v(" "),0!==t.album.length||t.isMySelf?t._e():o("div",{staticClass:"photo-wrap add-photo"},[o("span",[t._v("暂无照片")])])],2),t._v(" "),o("mu-dialog",{attrs:{open:t.dialog,title:"确认删除照片？",titleClass:"dialog-title",bodyClass:"dialog-body"},on:{close:t.close}},[o("mu-flat-button",{attrs:{slot:"actions",primary:"",label:"取消"},on:{click:t.cancel},slot:"actions"}),t._v(" "),o("mu-flat-button",{attrs:{slot:"actions",primary:"",label:"确定"},on:{click:t.confirm},slot:"actions"})],1),t._v(" "),o("my-croppa",{ref:"croppa",attrs:{option:t.myCroppaOption},on:{confirm:t.confirmCroppa,cancel:t.cancelCroppa}})],1)},i=[];n._withStripped=!0;var a={render:n,staticRenderFns:i};e.a=a}});
//# sourceMappingURL=28.2c0eec73217ac37f2c6f.js.map